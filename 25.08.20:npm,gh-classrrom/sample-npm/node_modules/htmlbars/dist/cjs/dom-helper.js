exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/*globals module, URL*/

var _htmlbarsRuntimeMorph = require("./htmlbars-runtime/morph");

var _htmlbarsRuntimeMorph2 = _interopRequireDefault(_htmlbarsRuntimeMorph);

var _morphAttr = require("./morph-attr");

var _morphAttr2 = _interopRequireDefault(_morphAttr);

var _domHelperBuildHtmlDom = require("./dom-helper/build-html-dom");

var _domHelperClasses = require("./dom-helper/classes");

var _domHelperProp = require("./dom-helper/prop");

var doc = typeof document === 'undefined' ? false : document;

var deletesBlankTextNodes = doc && (function (document) {
  var element = document.createElement('div');
  element.appendChild(document.createTextNode(''));
  var clonedElement = element.cloneNode(true);
  return clonedElement.childNodes.length === 0;
})(doc);

var ignoresCheckedAttribute = doc && (function (document) {
  var element = document.createElement('input');
  element.setAttribute('checked', 'checked');
  var clonedElement = element.cloneNode(false);
  return !clonedElement.checked;
})(doc);

var canRemoveSvgViewBoxAttribute = doc && (doc.createElementNS ? (function (document) {
  var element = document.createElementNS(_domHelperBuildHtmlDom.svgNamespace, 'svg');
  element.setAttribute('viewBox', '0 0 100 100');
  element.removeAttribute('viewBox');
  return !element.getAttribute('viewBox');
})(doc) : true);

var canClone = doc && (function (document) {
  var element = document.createElement('div');
  element.appendChild(document.createTextNode(' '));
  element.appendChild(document.createTextNode(' '));
  var clonedElement = element.cloneNode(true);
  return clonedElement.childNodes[0].nodeValue === ' ';
})(doc);

// This is not the namespace of the element, but of
// the elements inside that elements.
function interiorNamespace(element) {
  if (element && element.namespaceURI === _domHelperBuildHtmlDom.svgNamespace && !_domHelperBuildHtmlDom.svgHTMLIntegrationPoints[element.tagName]) {
    return _domHelperBuildHtmlDom.svgNamespace;
  } else {
    return null;
  }
}

// The HTML spec allows for "omitted start tags". These tags are optional
// when their intended child is the first thing in the parent tag. For
// example, this is a tbody start tag:
//
// <table>
//   <tbody>
//     <tr>
//
// The tbody may be omitted, and the browser will accept and render:
//
// <table>
//   <tr>
//
// However, the omitted start tag will still be added to the DOM. Here
// we test the string and context to see if the browser is about to
// perform this cleanup.
//
// http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html#optional-tags
// describes which tags are omittable. The spec for tbody and colgroup
// explains this behavior:
//
// http://www.whatwg.org/specs/web-apps/current-work/multipage/tables.html#the-tbody-element
// http://www.whatwg.org/specs/web-apps/current-work/multipage/tables.html#the-colgroup-element
//

var omittedStartTagChildTest = /<([\w:]+)/;
function detectOmittedStartTag(string, contextualElement) {
  // Omitted start tags are only inside table tags.
  if (contextualElement.tagName === 'TABLE') {
    var omittedStartTagChildMatch = omittedStartTagChildTest.exec(string);
    if (omittedStartTagChildMatch) {
      var omittedStartTagChild = omittedStartTagChildMatch[1];
      // It is already asserted that the contextual element is a table
      // and not the proper start tag. Just see if a tag was omitted.
      return omittedStartTagChild === 'tr' || omittedStartTagChild === 'col';
    }
  }
}

function buildSVGDOM(html, dom) {
  var div = dom.document.createElement('div');
  div.innerHTML = '<svg>' + html + '</svg>';
  return div.firstChild.childNodes;
}

var guid = 1;

function ElementMorph(element, dom, namespace) {
  this.element = element;
  this.dom = dom;
  this.namespace = namespace;
  this.guid = "element" + guid++;

  this._state = undefined;
  this.isDirty = true;
}

ElementMorph.prototype.getState = function () {
  if (!this._state) {
    this._state = {};
  }

  return this._state;
};

ElementMorph.prototype.setState = function (newState) {
  /*jshint -W093 */

  return this._state = newState;
};

// renderAndCleanup calls `clear` on all items in the morph map
// just before calling `destroy` on the morph.
//
// As a future refactor this could be changed to set the property
// back to its original/default value.
ElementMorph.prototype.clear = function () {};

ElementMorph.prototype.destroy = function () {
  this.element = null;
  this.dom = null;
};

/*
 * A class wrapping DOM functions to address environment compatibility,
 * namespaces, contextual elements for morph un-escaped content
 * insertion.
 *
 * When entering a template, a DOMHelper should be passed:
 *
 *   template(context, { hooks: hooks, dom: new DOMHelper() });
 *
 * TODO: support foreignObject as a passed contextual element. It has
 * a namespace (svg) that does not match its internal namespace
 * (xhtml).
 *
 * @class DOMHelper
 * @constructor
 * @param {HTMLDocument} _document The document DOM methods are proxied to
 */
function DOMHelper(_document) {
  this.document = _document || document;
  if (!this.document) {
    throw new Error("A document object must be passed to the DOMHelper, or available on the global scope");
  }
  this.canClone = canClone;
  this.namespace = null;

  installEnvironmentSpecificMethods(this);
}

var prototype = DOMHelper.prototype;
prototype.constructor = DOMHelper;

prototype.getElementById = function (id, rootNode) {
  rootNode = rootNode || this.document;
  return rootNode.getElementById(id);
};

prototype.insertBefore = function (element, childElement, referenceChild) {
  return element.insertBefore(childElement, referenceChild);
};

prototype.appendChild = function (element, childElement) {
  return element.appendChild(childElement);
};

var itemAt;

// It appears that sometimes, in yet to be itentified scenarios PhantomJS 2.0
// crashes on childNodes.item(index), but works as expected with childNodes[index];
//
// Although it would be nice to move to childNodes[index] in all scenarios,
// this would require SimpleDOM to maintain the childNodes array. This would be
// quite costly, in both dev time and runtime.
//
// So instead, we choose the best possible method and call it a day.
//
/*global navigator */
if (typeof navigator !== 'undefined' && navigator.userAgent.indexOf('PhantomJS')) {
  itemAt = function (nodes, index) {
    return nodes[index];
  };
} else {
  itemAt = function (nodes, index) {
    return nodes.item(index);
  };
}

prototype.childAt = function (element, indices) {
  var child = element;

  for (var i = 0; i < indices.length; i++) {
    child = itemAt(child.childNodes, indices[i]);
  }

  return child;
};

// Note to a Fellow Implementor:
// Ahh, accessing a child node at an index. Seems like it should be so simple,
// doesn't it? Unfortunately, this particular method has caused us a surprising
// amount of pain. As you'll note below, this method has been modified to walk
// the linked list of child nodes rather than access the child by index
// directly, even though there are two (2) APIs in the DOM that do this for us.
// If you're thinking to yourself, "What an oversight! What an opportunity to
// optimize this code!" then to you I say: stop! For I have a tale to tell.
//
// First, this code must be compatible with simple-dom for rendering on the
// server where there is no real DOM. Previously, we accessed a child node
// directly via `element.childNodes[index]`. While we *could* in theory do a
// full-fidelity simulation of a live `childNodes` array, this is slow,
// complicated and error-prone.
//
// "No problem," we thought, "we'll just use the similar
// `childNodes.item(index)` API." Then, we could just implement our own `item`
// method in simple-dom and walk the child node linked list there, allowing
// us to retain the performance advantages of the (surely optimized) `item()`
// API in the browser.
//
// Unfortunately, an enterprising soul named Samy Alzahrani discovered that in
// IE8, accessing an item out-of-bounds via `item()` causes an exception where
// other browsers return null. This necessitated a... check of
// `childNodes.length`, bringing us back around to having to support a
// full-fidelity `childNodes` array!
//
// Worst of all, Kris Selden investigated how browsers are actualy implemented
// and discovered that they're all linked lists under the hood anyway. Accessing
// `childNodes` requires them to allocate a new live collection backed by that
// linked list, which is itself a rather expensive operation. Our assumed
// optimization had backfired! That is the danger of magical thinking about
// the performance of native implementations.
//
// And this, my friends, is why the following implementation just walks the
// linked list, as surprised as that may make you. Please ensure you understand
// the above before changing this and submitting a PR.
//
// Tom Dale, January 18th, 2015, Portland OR
prototype.childAtIndex = function (element, index) {
  var node = element.firstChild;

  for (var idx = 0; node && idx < index; idx++) {
    node = node.nextSibling;
  }

  return node;
};

prototype.appendText = function (element, text) {
  return element.appendChild(this.document.createTextNode(text));
};

prototype.setAttribute = function (element, name, value) {
  element.setAttribute(name, String(value));
};

prototype.getAttribute = function (element, name) {
  return element.getAttribute(name);
};

prototype.setAttributeNS = function (element, namespace, name, value) {
  element.setAttributeNS(namespace, name, String(value));
};

prototype.getAttributeNS = function (element, namespace, name) {
  return element.getAttributeNS(namespace, name);
};

if (canRemoveSvgViewBoxAttribute) {
  prototype.removeAttribute = function (element, name) {
    element.removeAttribute(name);
  };
} else {
  prototype.removeAttribute = function (element, name) {
    if (element.tagName === 'svg' && name === 'viewBox') {
      element.setAttribute(name, null);
    } else {
      element.removeAttribute(name);
    }
  };
}

prototype.setPropertyStrict = function (element, name, value) {
  if (value === undefined) {
    value = null;
  }

  if (value === null && (name === 'value' || name === 'type' || name === 'src')) {
    value = '';
  }

  element[name] = value;
};

prototype.getPropertyStrict = function (element, name) {
  return element[name];
};

prototype.setProperty = function (element, name, value, namespace) {
  if (element.namespaceURI === _domHelperBuildHtmlDom.svgNamespace) {
    if (_domHelperProp.isAttrRemovalValue(value)) {
      element.removeAttribute(name);
    } else {
      if (namespace) {
        element.setAttributeNS(namespace, name, value);
      } else {
        element.setAttribute(name, value);
      }
    }
  } else {
    var _normalizeProperty = _domHelperProp.normalizeProperty(element, name);

    var normalized = _normalizeProperty.normalized;
    var type = _normalizeProperty.type;

    if (type === 'prop') {
      element[normalized] = value;
    } else {
      if (_domHelperProp.isAttrRemovalValue(value)) {
        element.removeAttribute(name);
      } else {
        if (namespace && element.setAttributeNS) {
          element.setAttributeNS(namespace, name, value);
        } else {
          element.setAttribute(name, value);
        }
      }
    }
  }
};

if (doc && doc.createElementNS) {
  // Only opt into namespace detection if a contextualElement
  // is passed.
  prototype.createElement = function (tagName, contextualElement) {
    var namespace = this.namespace;
    if (contextualElement) {
      if (tagName === 'svg') {
        namespace = _domHelperBuildHtmlDom.svgNamespace;
      } else {
        namespace = interiorNamespace(contextualElement);
      }
    }
    if (namespace) {
      return this.document.createElementNS(namespace, tagName);
    } else {
      return this.document.createElement(tagName);
    }
  };
  prototype.setAttributeNS = function (element, namespace, name, value) {
    element.setAttributeNS(namespace, name, String(value));
  };
} else {
  prototype.createElement = function (tagName) {
    return this.document.createElement(tagName);
  };
  prototype.setAttributeNS = function (element, namespace, name, value) {
    element.setAttribute(name, String(value));
  };
}

prototype.addClasses = _domHelperClasses.addClasses;
prototype.removeClasses = _domHelperClasses.removeClasses;

prototype.setNamespace = function (ns) {
  this.namespace = ns;
};

prototype.detectNamespace = function (element) {
  this.namespace = interiorNamespace(element);
};

prototype.createDocumentFragment = function () {
  return this.document.createDocumentFragment();
};

prototype.createTextNode = function (text) {
  return this.document.createTextNode(text);
};

prototype.createComment = function (text) {
  return this.document.createComment(text);
};

prototype.repairClonedNode = function (element, blankChildTextNodes, isChecked) {
  if (deletesBlankTextNodes && blankChildTextNodes.length > 0) {
    for (var i = 0, len = blankChildTextNodes.length; i < len; i++) {
      var textNode = this.document.createTextNode(''),
          offset = blankChildTextNodes[i],
          before = this.childAtIndex(element, offset);
      if (before) {
        element.insertBefore(textNode, before);
      } else {
        element.appendChild(textNode);
      }
    }
  }
  if (ignoresCheckedAttribute && isChecked) {
    element.setAttribute('checked', 'checked');
  }
};

prototype.cloneNode = function (element, deep) {
  var clone = element.cloneNode(!!deep);
  return clone;
};

prototype.AttrMorphClass = _morphAttr2.default;

prototype.createAttrMorph = function (element, attrName, namespace) {
  return this.AttrMorphClass.create(element, attrName, this, namespace);
};

prototype.ElementMorphClass = ElementMorph;

prototype.createElementMorph = function (element, namespace) {
  return new this.ElementMorphClass(element, this, namespace);
};

prototype.createUnsafeAttrMorph = function (element, attrName, namespace) {
  var morph = this.createAttrMorph(element, attrName, namespace);
  morph.escaped = false;
  return morph;
};

prototype.MorphClass = _htmlbarsRuntimeMorph2.default;

prototype.createMorph = function (parent, start, end, contextualElement) {
  if (contextualElement && contextualElement.nodeType === 11) {
    throw new Error("Cannot pass a fragment as the contextual element to createMorph");
  }

  if (!contextualElement && parent && parent.nodeType === 1) {
    contextualElement = parent;
  }
  var morph = new this.MorphClass(this, contextualElement);
  morph.firstNode = start;
  morph.lastNode = end;
  return morph;
};

prototype.createFragmentMorph = function (contextualElement) {
  if (contextualElement && contextualElement.nodeType === 11) {
    throw new Error("Cannot pass a fragment as the contextual element to createMorph");
  }

  var fragment = this.createDocumentFragment();
  return _htmlbarsRuntimeMorph2.default.create(this, contextualElement, fragment);
};

prototype.replaceContentWithMorph = function (element) {
  var firstChild = element.firstChild;

  if (!firstChild) {
    var comment = this.createComment('');
    this.appendChild(element, comment);
    return _htmlbarsRuntimeMorph2.default.create(this, element, comment);
  } else {
    var morph = _htmlbarsRuntimeMorph2.default.attach(this, element, firstChild, element.lastChild);
    morph.clear();
    return morph;
  }
};

prototype.createUnsafeMorph = function (parent, start, end, contextualElement) {
  var morph = this.createMorph(parent, start, end, contextualElement);
  morph.parseTextAsHTML = true;
  return morph;
};

// This helper is just to keep the templates good looking,
// passing integers instead of element references.
prototype.createMorphAt = function (parent, startIndex, endIndex, contextualElement) {
  var single = startIndex === endIndex;
  var start = this.childAtIndex(parent, startIndex);
  var end = single ? start : this.childAtIndex(parent, endIndex);
  return this.createMorph(parent, start, end, contextualElement);
};

prototype.createUnsafeMorphAt = function (parent, startIndex, endIndex, contextualElement) {
  var morph = this.createMorphAt(parent, startIndex, endIndex, contextualElement);
  morph.parseTextAsHTML = true;
  return morph;
};

prototype.insertMorphBefore = function (element, referenceChild, contextualElement) {
  var insertion = this.document.createComment('');
  element.insertBefore(insertion, referenceChild);
  return this.createMorph(element, insertion, insertion, contextualElement);
};

prototype.appendMorph = function (element, contextualElement) {
  var insertion = this.document.createComment('');
  element.appendChild(insertion);
  return this.createMorph(element, insertion, insertion, contextualElement);
};

prototype.insertBoundary = function (fragment, index) {
  // this will always be null or firstChild
  var child = index === null ? null : this.childAtIndex(fragment, index);
  this.insertBefore(fragment, this.createTextNode(''), child);
};

prototype.setMorphHTML = function (morph, html) {
  morph.setHTML(html);
};

prototype.parseHTML = function (html, contextualElement) {
  var childNodes;

  if (interiorNamespace(contextualElement) === _domHelperBuildHtmlDom.svgNamespace) {
    childNodes = buildSVGDOM(html, this);
  } else {
    var nodes = _domHelperBuildHtmlDom.buildHTMLDOM(html, contextualElement, this);
    if (detectOmittedStartTag(html, contextualElement)) {
      var node = nodes[0];
      while (node && node.nodeType !== 1) {
        node = node.nextSibling;
      }
      childNodes = node.childNodes;
    } else {
      childNodes = nodes;
    }
  }

  // Copy node list to a fragment.
  var fragment = this.document.createDocumentFragment();

  if (childNodes && childNodes.length > 0) {
    var currentNode = childNodes[0];

    // We prepend an <option> to <select> boxes to absorb any browser bugs
    // related to auto-select behavior. Skip past it.
    if (contextualElement.tagName === 'SELECT') {
      currentNode = currentNode.nextSibling;
    }

    while (currentNode) {
      var tempNode = currentNode;
      currentNode = currentNode.nextSibling;

      fragment.appendChild(tempNode);
    }
  }

  return fragment;
};

var nodeURL;
var parsingNode;

function installEnvironmentSpecificMethods(domHelper) {
  var protocol = browserProtocolForURL.call(domHelper, 'foobar:baz');

  // Test to see if our DOM implementation parses
  // and normalizes URLs.
  if (protocol === 'foobar:') {
    // Swap in the method that doesn't do this test now that
    // we know it works.
    domHelper.protocolForURL = browserProtocolForURL;
  } else if (typeof URL === 'object') {
    // URL globally provided, likely from FastBoot's sandbox
    nodeURL = URL;
    domHelper.protocolForURL = nodeProtocolForURL;
  } else if (typeof module === 'object' && typeof module.require === 'function') {
    // Otherwise, we need to fall back to our own URL parsing.
    // Global `require` is shadowed by Ember's loader so we have to use the fully
    // qualified `module.require`.
    nodeURL = module.require('url');
    domHelper.protocolForURL = nodeProtocolForURL;
  } else {
    throw new Error("DOM Helper could not find valid URL parsing mechanism");
  }

  // A SimpleDOM-specific extension that allows us to place HTML directly
  // into the DOM tree, for when the output target is always serialized HTML.
  if (domHelper.document.createRawHTMLSection) {
    domHelper.setMorphHTML = nodeSetMorphHTML;
  }
}

function nodeSetMorphHTML(morph, html) {
  var section = this.document.createRawHTMLSection(html);
  morph.setNode(section);
}

function browserProtocolForURL(url) {
  if (!parsingNode) {
    parsingNode = this.document.createElement('a');
  }

  parsingNode.href = url;
  return parsingNode.protocol;
}

function nodeProtocolForURL(url) {
  var protocol = null;
  if (typeof url === 'string') {
    protocol = nodeURL.parse(url).protocol;
  }
  return protocol === null ? ':' : protocol;
}

exports.default = DOMHelper;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,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QVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztHQUNoRDs7QUFFRCxhQUFXLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQztBQUN2QixTQUFPLFdBQVcsQ0FBQyxRQUFRLENBQUM7Q0FDN0I7O0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7QUFDL0IsTUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQ3BCLE1BQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFO0FBQzNCLFlBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQztHQUN4QztBQUNELFNBQU8sQUFBQyxRQUFRLEtBQUssSUFBSSxHQUFJLEdBQUcsR0FBRyxRQUFRLENBQUM7Q0FDN0M7O2tCQUVjLFNBQVMiLCJmaWxlIjoiZG9tLWhlbHBlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFscyBtb2R1bGUsIFVSTCovXG5cbmltcG9ydCBNb3JwaCBmcm9tIFwiLi9odG1sYmFycy1ydW50aW1lL21vcnBoXCI7XG5pbXBvcnQgQXR0ck1vcnBoIGZyb20gXCIuL21vcnBoLWF0dHJcIjtcbmltcG9ydCB7XG4gIGJ1aWxkSFRNTERPTSxcbiAgc3ZnTmFtZXNwYWNlLFxuICBzdmdIVE1MSW50ZWdyYXRpb25Qb2ludHNcbn0gZnJvbSBcIi4vZG9tLWhlbHBlci9idWlsZC1odG1sLWRvbVwiO1xuaW1wb3J0IHtcbiAgYWRkQ2xhc3NlcyxcbiAgcmVtb3ZlQ2xhc3Nlc1xufSBmcm9tIFwiLi9kb20taGVscGVyL2NsYXNzZXNcIjtcbmltcG9ydCB7XG4gIG5vcm1hbGl6ZVByb3BlcnR5XG59IGZyb20gXCIuL2RvbS1oZWxwZXIvcHJvcFwiO1xuaW1wb3J0IHsgaXNBdHRyUmVtb3ZhbFZhbHVlIH0gZnJvbSBcIi4vZG9tLWhlbHBlci9wcm9wXCI7XG5cbnZhciBkb2MgPSB0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnID8gZmFsc2UgOiBkb2N1bWVudDtcblxudmFyIGRlbGV0ZXNCbGFua1RleHROb2RlcyA9IGRvYyAmJiAoZnVuY3Rpb24oZG9jdW1lbnQpe1xuICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBlbGVtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJykgKTtcbiAgdmFyIGNsb25lZEVsZW1lbnQgPSBlbGVtZW50LmNsb25lTm9kZSh0cnVlKTtcbiAgcmV0dXJuIGNsb25lZEVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPT09IDA7XG59KShkb2MpO1xuXG52YXIgaWdub3Jlc0NoZWNrZWRBdHRyaWJ1dGUgPSBkb2MgJiYgKGZ1bmN0aW9uKGRvY3VtZW50KXtcbiAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsICdjaGVja2VkJyk7XG4gIHZhciBjbG9uZWRFbGVtZW50ID0gZWxlbWVudC5jbG9uZU5vZGUoZmFsc2UpO1xuICByZXR1cm4gIWNsb25lZEVsZW1lbnQuY2hlY2tlZDtcbn0pKGRvYyk7XG5cbnZhciBjYW5SZW1vdmVTdmdWaWV3Qm94QXR0cmlidXRlID0gZG9jICYmIChkb2MuY3JlYXRlRWxlbWVudE5TID8gKGZ1bmN0aW9uKGRvY3VtZW50KXtcbiAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTmFtZXNwYWNlLCAnc3ZnJyk7XG4gIGVsZW1lbnQuc2V0QXR0cmlidXRlKCd2aWV3Qm94JywgJzAgMCAxMDAgMTAwJyk7XG4gIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCd2aWV3Qm94Jyk7XG4gIHJldHVybiAhZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnKTtcbn0pKGRvYykgOiB0cnVlKTtcblxudmFyIGNhbkNsb25lID0gZG9jICYmIChmdW5jdGlvbihkb2N1bWVudCl7XG4gIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGVsZW1lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgJykpO1xuICBlbGVtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcpKTtcbiAgdmFyIGNsb25lZEVsZW1lbnQgPSBlbGVtZW50LmNsb25lTm9kZSh0cnVlKTtcbiAgcmV0dXJuIGNsb25lZEVsZW1lbnQuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICcgJztcbn0pKGRvYyk7XG5cbi8vIFRoaXMgaXMgbm90IHRoZSBuYW1lc3BhY2Ugb2YgdGhlIGVsZW1lbnQsIGJ1dCBvZlxuLy8gdGhlIGVsZW1lbnRzIGluc2lkZSB0aGF0IGVsZW1lbnRzLlxuZnVuY3Rpb24gaW50ZXJpb3JOYW1lc3BhY2UoZWxlbWVudCl7XG4gIGlmIChcbiAgICBlbGVtZW50ICYmXG4gICAgZWxlbWVudC5uYW1lc3BhY2VVUkkgPT09IHN2Z05hbWVzcGFjZSAmJlxuICAgICFzdmdIVE1MSW50ZWdyYXRpb25Qb2ludHNbZWxlbWVudC50YWdOYW1lXVxuICApIHtcbiAgICByZXR1cm4gc3ZnTmFtZXNwYWNlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8vIFRoZSBIVE1MIHNwZWMgYWxsb3dzIGZvciBcIm9taXR0ZWQgc3RhcnQgdGFnc1wiLiBUaGVzZSB0YWdzIGFyZSBvcHRpb25hbFxuLy8gd2hlbiB0aGVpciBpbnRlbmRlZCBjaGlsZCBpcyB0aGUgZmlyc3QgdGhpbmcgaW4gdGhlIHBhcmVudCB0YWcuIEZvclxuLy8gZXhhbXBsZSwgdGhpcyBpcyBhIHRib2R5IHN0YXJ0IHRhZzpcbi8vXG4vLyA8dGFibGU+XG4vLyAgIDx0Ym9keT5cbi8vICAgICA8dHI+XG4vL1xuLy8gVGhlIHRib2R5IG1heSBiZSBvbWl0dGVkLCBhbmQgdGhlIGJyb3dzZXIgd2lsbCBhY2NlcHQgYW5kIHJlbmRlcjpcbi8vXG4vLyA8dGFibGU+XG4vLyAgIDx0cj5cbi8vXG4vLyBIb3dldmVyLCB0aGUgb21pdHRlZCBzdGFydCB0YWcgd2lsbCBzdGlsbCBiZSBhZGRlZCB0byB0aGUgRE9NLiBIZXJlXG4vLyB3ZSB0ZXN0IHRoZSBzdHJpbmcgYW5kIGNvbnRleHQgdG8gc2VlIGlmIHRoZSBicm93c2VyIGlzIGFib3V0IHRvXG4vLyBwZXJmb3JtIHRoaXMgY2xlYW51cC5cbi8vXG4vLyBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS9zeW50YXguaHRtbCNvcHRpb25hbC10YWdzXG4vLyBkZXNjcmliZXMgd2hpY2ggdGFncyBhcmUgb21pdHRhYmxlLiBUaGUgc3BlYyBmb3IgdGJvZHkgYW5kIGNvbGdyb3VwXG4vLyBleHBsYWlucyB0aGlzIGJlaGF2aW9yOlxuLy9cbi8vIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3RhYmxlcy5odG1sI3RoZS10Ym9keS1lbGVtZW50XG4vLyBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS90YWJsZXMuaHRtbCN0aGUtY29sZ3JvdXAtZWxlbWVudFxuLy9cblxudmFyIG9taXR0ZWRTdGFydFRhZ0NoaWxkVGVzdCA9IC88KFtcXHc6XSspLztcbmZ1bmN0aW9uIGRldGVjdE9taXR0ZWRTdGFydFRhZyhzdHJpbmcsIGNvbnRleHR1YWxFbGVtZW50KXtcbiAgLy8gT21pdHRlZCBzdGFydCB0YWdzIGFyZSBvbmx5IGluc2lkZSB0YWJsZSB0YWdzLlxuICBpZiAoY29udGV4dHVhbEVsZW1lbnQudGFnTmFtZSA9PT0gJ1RBQkxFJykge1xuICAgIHZhciBvbWl0dGVkU3RhcnRUYWdDaGlsZE1hdGNoID0gb21pdHRlZFN0YXJ0VGFnQ2hpbGRUZXN0LmV4ZWMoc3RyaW5nKTtcbiAgICBpZiAob21pdHRlZFN0YXJ0VGFnQ2hpbGRNYXRjaCkge1xuICAgICAgdmFyIG9taXR0ZWRTdGFydFRhZ0NoaWxkID0gb21pdHRlZFN0YXJ0VGFnQ2hpbGRNYXRjaFsxXTtcbiAgICAgIC8vIEl0IGlzIGFscmVhZHkgYXNzZXJ0ZWQgdGhhdCB0aGUgY29udGV4dHVhbCBlbGVtZW50IGlzIGEgdGFibGVcbiAgICAgIC8vIGFuZCBub3QgdGhlIHByb3BlciBzdGFydCB0YWcuIEp1c3Qgc2VlIGlmIGEgdGFnIHdhcyBvbWl0dGVkLlxuICAgICAgcmV0dXJuIG9taXR0ZWRTdGFydFRhZ0NoaWxkID09PSAndHInIHx8XG4gICAgICAgICAgICAgb21pdHRlZFN0YXJ0VGFnQ2hpbGQgPT09ICdjb2wnO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZFNWR0RPTShodG1sLCBkb20pe1xuICB2YXIgZGl2ID0gZG9tLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBkaXYuaW5uZXJIVE1MID0gJzxzdmc+JytodG1sKyc8L3N2Zz4nO1xuICByZXR1cm4gZGl2LmZpcnN0Q2hpbGQuY2hpbGROb2Rlcztcbn1cblxudmFyIGd1aWQgPSAxO1xuXG5mdW5jdGlvbiBFbGVtZW50TW9ycGgoZWxlbWVudCwgZG9tLCBuYW1lc3BhY2UpIHtcbiAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgdGhpcy5kb20gPSBkb207XG4gIHRoaXMubmFtZXNwYWNlID0gbmFtZXNwYWNlO1xuICB0aGlzLmd1aWQgPSBcImVsZW1lbnRcIiArIGd1aWQrKztcblxuICB0aGlzLl9zdGF0ZSA9IHVuZGVmaW5lZDtcbiAgdGhpcy5pc0RpcnR5ID0gdHJ1ZTtcbn1cblxuRWxlbWVudE1vcnBoLnByb3RvdHlwZS5nZXRTdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuX3N0YXRlKSB7XG4gICAgdGhpcy5fc3RhdGUgPSB7fTtcbiAgfVxuXG4gIHJldHVybiB0aGlzLl9zdGF0ZTtcbn07XG5cbkVsZW1lbnRNb3JwaC5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbihuZXdTdGF0ZSkge1xuICAvKmpzaGludCAtVzA5MyAqL1xuXG4gIHJldHVybiB0aGlzLl9zdGF0ZSA9IG5ld1N0YXRlO1xufTtcblxuLy8gcmVuZGVyQW5kQ2xlYW51cCBjYWxscyBgY2xlYXJgIG9uIGFsbCBpdGVtcyBpbiB0aGUgbW9ycGggbWFwXG4vLyBqdXN0IGJlZm9yZSBjYWxsaW5nIGBkZXN0cm95YCBvbiB0aGUgbW9ycGguXG4vL1xuLy8gQXMgYSBmdXR1cmUgcmVmYWN0b3IgdGhpcyBjb3VsZCBiZSBjaGFuZ2VkIHRvIHNldCB0aGUgcHJvcGVydHlcbi8vIGJhY2sgdG8gaXRzIG9yaWdpbmFsL2RlZmF1bHQgdmFsdWUuXG5FbGVtZW50TW9ycGgucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7IH07XG5cbkVsZW1lbnRNb3JwaC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICB0aGlzLmRvbSA9IG51bGw7XG59O1xuXG5cbi8qXG4gKiBBIGNsYXNzIHdyYXBwaW5nIERPTSBmdW5jdGlvbnMgdG8gYWRkcmVzcyBlbnZpcm9ubWVudCBjb21wYXRpYmlsaXR5LFxuICogbmFtZXNwYWNlcywgY29udGV4dHVhbCBlbGVtZW50cyBmb3IgbW9ycGggdW4tZXNjYXBlZCBjb250ZW50XG4gKiBpbnNlcnRpb24uXG4gKlxuICogV2hlbiBlbnRlcmluZyBhIHRlbXBsYXRlLCBhIERPTUhlbHBlciBzaG91bGQgYmUgcGFzc2VkOlxuICpcbiAqICAgdGVtcGxhdGUoY29udGV4dCwgeyBob29rczogaG9va3MsIGRvbTogbmV3IERPTUhlbHBlcigpIH0pO1xuICpcbiAqIFRPRE86IHN1cHBvcnQgZm9yZWlnbk9iamVjdCBhcyBhIHBhc3NlZCBjb250ZXh0dWFsIGVsZW1lbnQuIEl0IGhhc1xuICogYSBuYW1lc3BhY2UgKHN2ZykgdGhhdCBkb2VzIG5vdCBtYXRjaCBpdHMgaW50ZXJuYWwgbmFtZXNwYWNlXG4gKiAoeGh0bWwpLlxuICpcbiAqIEBjbGFzcyBET01IZWxwZXJcbiAqIEBjb25zdHJ1Y3RvclxuICogQHBhcmFtIHtIVE1MRG9jdW1lbnR9IF9kb2N1bWVudCBUaGUgZG9jdW1lbnQgRE9NIG1ldGhvZHMgYXJlIHByb3hpZWQgdG9cbiAqL1xuZnVuY3Rpb24gRE9NSGVscGVyKF9kb2N1bWVudCl7XG4gIHRoaXMuZG9jdW1lbnQgPSBfZG9jdW1lbnQgfHwgZG9jdW1lbnQ7XG4gIGlmICghdGhpcy5kb2N1bWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkEgZG9jdW1lbnQgb2JqZWN0IG11c3QgYmUgcGFzc2VkIHRvIHRoZSBET01IZWxwZXIsIG9yIGF2YWlsYWJsZSBvbiB0aGUgZ2xvYmFsIHNjb3BlXCIpO1xuICB9XG4gIHRoaXMuY2FuQ2xvbmUgPSBjYW5DbG9uZTtcbiAgdGhpcy5uYW1lc3BhY2UgPSBudWxsO1xuXG4gIGluc3RhbGxFbnZpcm9ubWVudFNwZWNpZmljTWV0aG9kcyh0aGlzKTtcbn1cblxudmFyIHByb3RvdHlwZSA9IERPTUhlbHBlci5wcm90b3R5cGU7XG5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBET01IZWxwZXI7XG5cbnByb3RvdHlwZS5nZXRFbGVtZW50QnlJZCA9IGZ1bmN0aW9uKGlkLCByb290Tm9kZSkge1xuICByb290Tm9kZSA9IHJvb3ROb2RlIHx8IHRoaXMuZG9jdW1lbnQ7XG4gIHJldHVybiByb290Tm9kZS5nZXRFbGVtZW50QnlJZChpZCk7XG59O1xuXG5wcm90b3R5cGUuaW5zZXJ0QmVmb3JlID0gZnVuY3Rpb24oZWxlbWVudCwgY2hpbGRFbGVtZW50LCByZWZlcmVuY2VDaGlsZCkge1xuICByZXR1cm4gZWxlbWVudC5pbnNlcnRCZWZvcmUoY2hpbGRFbGVtZW50LCByZWZlcmVuY2VDaGlsZCk7XG59O1xuXG5wcm90b3R5cGUuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbihlbGVtZW50LCBjaGlsZEVsZW1lbnQpIHtcbiAgcmV0dXJuIGVsZW1lbnQuYXBwZW5kQ2hpbGQoY2hpbGRFbGVtZW50KTtcbn07XG5cbnZhciBpdGVtQXQ7XG5cbi8vIEl0IGFwcGVhcnMgdGhhdCBzb21ldGltZXMsIGluIHlldCB0byBiZSBpdGVudGlmaWVkIHNjZW5hcmlvcyBQaGFudG9tSlMgMi4wXG4vLyBjcmFzaGVzIG9uIGNoaWxkTm9kZXMuaXRlbShpbmRleCksIGJ1dCB3b3JrcyBhcyBleHBlY3RlZCB3aXRoIGNoaWxkTm9kZXNbaW5kZXhdO1xuLy9cbi8vIEFsdGhvdWdoIGl0IHdvdWxkIGJlIG5pY2UgdG8gbW92ZSB0byBjaGlsZE5vZGVzW2luZGV4XSBpbiBhbGwgc2NlbmFyaW9zLFxuLy8gdGhpcyB3b3VsZCByZXF1aXJlIFNpbXBsZURPTSB0byBtYWludGFpbiB0aGUgY2hpbGROb2RlcyBhcnJheS4gVGhpcyB3b3VsZCBiZVxuLy8gcXVpdGUgY29zdGx5LCBpbiBib3RoIGRldiB0aW1lIGFuZCBydW50aW1lLlxuLy9cbi8vIFNvIGluc3RlYWQsIHdlIGNob29zZSB0aGUgYmVzdCBwb3NzaWJsZSBtZXRob2QgYW5kIGNhbGwgaXQgYSBkYXkuXG4vL1xuLypnbG9iYWwgbmF2aWdhdG9yICovXG5pZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1BoYW50b21KUycpKSB7XG4gIGl0ZW1BdCA9IGZ1bmN0aW9uKG5vZGVzLCBpbmRleCkge1xuICAgIHJldHVybiBub2Rlc1tpbmRleF07XG4gIH07XG59IGVsc2Uge1xuICBpdGVtQXQgPSBmdW5jdGlvbihub2RlcywgaW5kZXgpIHtcbiAgICByZXR1cm4gbm9kZXMuaXRlbShpbmRleCk7XG4gIH07XG59XG5cbnByb3RvdHlwZS5jaGlsZEF0ID0gZnVuY3Rpb24oZWxlbWVudCwgaW5kaWNlcykge1xuICB2YXIgY2hpbGQgPSBlbGVtZW50O1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNlcy5sZW5ndGg7IGkrKykge1xuICAgIGNoaWxkID0gaXRlbUF0KGNoaWxkLmNoaWxkTm9kZXMsIGluZGljZXNbaV0pO1xuICB9XG5cbiAgcmV0dXJuIGNoaWxkO1xufTtcblxuLy8gTm90ZSB0byBhIEZlbGxvdyBJbXBsZW1lbnRvcjpcbi8vIEFoaCwgYWNjZXNzaW5nIGEgY2hpbGQgbm9kZSBhdCBhbiBpbmRleC4gU2VlbXMgbGlrZSBpdCBzaG91bGQgYmUgc28gc2ltcGxlLFxuLy8gZG9lc24ndCBpdD8gVW5mb3J0dW5hdGVseSwgdGhpcyBwYXJ0aWN1bGFyIG1ldGhvZCBoYXMgY2F1c2VkIHVzIGEgc3VycHJpc2luZ1xuLy8gYW1vdW50IG9mIHBhaW4uIEFzIHlvdSdsbCBub3RlIGJlbG93LCB0aGlzIG1ldGhvZCBoYXMgYmVlbiBtb2RpZmllZCB0byB3YWxrXG4vLyB0aGUgbGlua2VkIGxpc3Qgb2YgY2hpbGQgbm9kZXMgcmF0aGVyIHRoYW4gYWNjZXNzIHRoZSBjaGlsZCBieSBpbmRleFxuLy8gZGlyZWN0bHksIGV2ZW4gdGhvdWdoIHRoZXJlIGFyZSB0d28gKDIpIEFQSXMgaW4gdGhlIERPTSB0aGF0IGRvIHRoaXMgZm9yIHVzLlxuLy8gSWYgeW91J3JlIHRoaW5raW5nIHRvIHlvdXJzZWxmLCBcIldoYXQgYW4gb3ZlcnNpZ2h0ISBXaGF0IGFuIG9wcG9ydHVuaXR5IHRvXG4vLyBvcHRpbWl6ZSB0aGlzIGNvZGUhXCIgdGhlbiB0byB5b3UgSSBzYXk6IHN0b3AhIEZvciBJIGhhdmUgYSB0YWxlIHRvIHRlbGwuXG4vL1xuLy8gRmlyc3QsIHRoaXMgY29kZSBtdXN0IGJlIGNvbXBhdGlibGUgd2l0aCBzaW1wbGUtZG9tIGZvciByZW5kZXJpbmcgb24gdGhlXG4vLyBzZXJ2ZXIgd2hlcmUgdGhlcmUgaXMgbm8gcmVhbCBET00uIFByZXZpb3VzbHksIHdlIGFjY2Vzc2VkIGEgY2hpbGQgbm9kZVxuLy8gZGlyZWN0bHkgdmlhIGBlbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdYC4gV2hpbGUgd2UgKmNvdWxkKiBpbiB0aGVvcnkgZG8gYVxuLy8gZnVsbC1maWRlbGl0eSBzaW11bGF0aW9uIG9mIGEgbGl2ZSBgY2hpbGROb2Rlc2AgYXJyYXksIHRoaXMgaXMgc2xvdyxcbi8vIGNvbXBsaWNhdGVkIGFuZCBlcnJvci1wcm9uZS5cbi8vXG4vLyBcIk5vIHByb2JsZW0sXCIgd2UgdGhvdWdodCwgXCJ3ZSdsbCBqdXN0IHVzZSB0aGUgc2ltaWxhclxuLy8gYGNoaWxkTm9kZXMuaXRlbShpbmRleClgIEFQSS5cIiBUaGVuLCB3ZSBjb3VsZCBqdXN0IGltcGxlbWVudCBvdXIgb3duIGBpdGVtYFxuLy8gbWV0aG9kIGluIHNpbXBsZS1kb20gYW5kIHdhbGsgdGhlIGNoaWxkIG5vZGUgbGlua2VkIGxpc3QgdGhlcmUsIGFsbG93aW5nXG4vLyB1cyB0byByZXRhaW4gdGhlIHBlcmZvcm1hbmNlIGFkdmFudGFnZXMgb2YgdGhlIChzdXJlbHkgb3B0aW1pemVkKSBgaXRlbSgpYFxuLy8gQVBJIGluIHRoZSBicm93c2VyLlxuLy9cbi8vIFVuZm9ydHVuYXRlbHksIGFuIGVudGVycHJpc2luZyBzb3VsIG5hbWVkIFNhbXkgQWx6YWhyYW5pIGRpc2NvdmVyZWQgdGhhdCBpblxuLy8gSUU4LCBhY2Nlc3NpbmcgYW4gaXRlbSBvdXQtb2YtYm91bmRzIHZpYSBgaXRlbSgpYCBjYXVzZXMgYW4gZXhjZXB0aW9uIHdoZXJlXG4vLyBvdGhlciBicm93c2VycyByZXR1cm4gbnVsbC4gVGhpcyBuZWNlc3NpdGF0ZWQgYS4uLiBjaGVjayBvZlxuLy8gYGNoaWxkTm9kZXMubGVuZ3RoYCwgYnJpbmdpbmcgdXMgYmFjayBhcm91bmQgdG8gaGF2aW5nIHRvIHN1cHBvcnQgYVxuLy8gZnVsbC1maWRlbGl0eSBgY2hpbGROb2Rlc2AgYXJyYXkhXG4vL1xuLy8gV29yc3Qgb2YgYWxsLCBLcmlzIFNlbGRlbiBpbnZlc3RpZ2F0ZWQgaG93IGJyb3dzZXJzIGFyZSBhY3R1YWx5IGltcGxlbWVudGVkXG4vLyBhbmQgZGlzY292ZXJlZCB0aGF0IHRoZXkncmUgYWxsIGxpbmtlZCBsaXN0cyB1bmRlciB0aGUgaG9vZCBhbnl3YXkuIEFjY2Vzc2luZ1xuLy8gYGNoaWxkTm9kZXNgIHJlcXVpcmVzIHRoZW0gdG8gYWxsb2NhdGUgYSBuZXcgbGl2ZSBjb2xsZWN0aW9uIGJhY2tlZCBieSB0aGF0XG4vLyBsaW5rZWQgbGlzdCwgd2hpY2ggaXMgaXRzZWxmIGEgcmF0aGVyIGV4cGVuc2l2ZSBvcGVyYXRpb24uIE91ciBhc3N1bWVkXG4vLyBvcHRpbWl6YXRpb24gaGFkIGJhY2tmaXJlZCEgVGhhdCBpcyB0aGUgZGFuZ2VyIG9mIG1hZ2ljYWwgdGhpbmtpbmcgYWJvdXRcbi8vIHRoZSBwZXJmb3JtYW5jZSBvZiBuYXRpdmUgaW1wbGVtZW50YXRpb25zLlxuLy9cbi8vIEFuZCB0aGlzLCBteSBmcmllbmRzLCBpcyB3aHkgdGhlIGZvbGxvd2luZyBpbXBsZW1lbnRhdGlvbiBqdXN0IHdhbGtzIHRoZVxuLy8gbGlua2VkIGxpc3QsIGFzIHN1cnByaXNlZCBhcyB0aGF0IG1heSBtYWtlIHlvdS4gUGxlYXNlIGVuc3VyZSB5b3UgdW5kZXJzdGFuZFxuLy8gdGhlIGFib3ZlIGJlZm9yZSBjaGFuZ2luZyB0aGlzIGFuZCBzdWJtaXR0aW5nIGEgUFIuXG4vL1xuLy8gVG9tIERhbGUsIEphbnVhcnkgMTh0aCwgMjAxNSwgUG9ydGxhbmQgT1JcbnByb3RvdHlwZS5jaGlsZEF0SW5kZXggPSBmdW5jdGlvbihlbGVtZW50LCBpbmRleCkge1xuICB2YXIgbm9kZSA9IGVsZW1lbnQuZmlyc3RDaGlsZDtcblxuICBmb3IgKHZhciBpZHggPSAwOyBub2RlICYmIGlkeCA8IGluZGV4OyBpZHgrKykge1xuICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuICB9XG5cbiAgcmV0dXJuIG5vZGU7XG59O1xuXG5wcm90b3R5cGUuYXBwZW5kVGV4dCA9IGZ1bmN0aW9uKGVsZW1lbnQsIHRleHQpIHtcbiAgcmV0dXJuIGVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KSk7XG59O1xuXG5wcm90b3R5cGUuc2V0QXR0cmlidXRlID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZSwgdmFsdWUpIHtcbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgU3RyaW5nKHZhbHVlKSk7XG59O1xuXG5wcm90b3R5cGUuZ2V0QXR0cmlidXRlID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZSkge1xuICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUobmFtZSk7XG59O1xuXG5wcm90b3R5cGUuc2V0QXR0cmlidXRlTlMgPSBmdW5jdGlvbihlbGVtZW50LCBuYW1lc3BhY2UsIG5hbWUsIHZhbHVlKSB7XG4gIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobmFtZXNwYWNlLCBuYW1lLCBTdHJpbmcodmFsdWUpKTtcbn07XG5cbnByb3RvdHlwZS5nZXRBdHRyaWJ1dGVOUyA9IGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWVzcGFjZSwgbmFtZSkge1xuICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGVOUyhuYW1lc3BhY2UsIG5hbWUpO1xufTtcblxuaWYgKGNhblJlbW92ZVN2Z1ZpZXdCb3hBdHRyaWJ1dGUpe1xuICBwcm90b3R5cGUucmVtb3ZlQXR0cmlidXRlID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZSkge1xuICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKG5hbWUpO1xuICB9O1xufSBlbHNlIHtcbiAgcHJvdG90eXBlLnJlbW92ZUF0dHJpYnV0ZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWUpIHtcbiAgICBpZiAoZWxlbWVudC50YWdOYW1lID09PSAnc3ZnJyAmJiBuYW1lID09PSAndmlld0JveCcpIHtcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIG51bGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShuYW1lKTtcbiAgICB9XG4gIH07XG59XG5cbnByb3RvdHlwZS5zZXRQcm9wZXJ0eVN0cmljdCA9IGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWUsIHZhbHVlKSB7XG4gIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdmFsdWUgPSBudWxsO1xuICB9XG5cbiAgaWYgKHZhbHVlID09PSBudWxsICYmIChuYW1lID09PSAndmFsdWUnIHx8IG5hbWUgPT09ICd0eXBlJyB8fCBuYW1lID09PSAnc3JjJykpIHtcbiAgICB2YWx1ZSA9ICcnO1xuICB9XG5cbiAgZWxlbWVudFtuYW1lXSA9IHZhbHVlO1xufTtcblxucHJvdG90eXBlLmdldFByb3BlcnR5U3RyaWN0ID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZSkge1xuICByZXR1cm4gZWxlbWVudFtuYW1lXTtcbn07XG5cbnByb3RvdHlwZS5zZXRQcm9wZXJ0eSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2UpIHtcbiAgaWYgKGVsZW1lbnQubmFtZXNwYWNlVVJJID09PSBzdmdOYW1lc3BhY2UpIHtcbiAgICBpZiAoaXNBdHRyUmVtb3ZhbFZhbHVlKHZhbHVlKSkge1xuICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChuYW1lc3BhY2UpIHtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhuYW1lc3BhY2UsIG5hbWUsIHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdmFyIHsgbm9ybWFsaXplZCAsIHR5cGUgfSA9IG5vcm1hbGl6ZVByb3BlcnR5KGVsZW1lbnQsIG5hbWUpO1xuICAgIGlmICh0eXBlID09PSAncHJvcCcpIHtcbiAgICAgIGVsZW1lbnRbbm9ybWFsaXplZF0gPSB2YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGlzQXR0clJlbW92YWxWYWx1ZSh2YWx1ZSkpIHtcbiAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAobmFtZXNwYWNlICYmIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMpIHtcbiAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZU5TKG5hbWVzcGFjZSwgbmFtZSwgdmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuaWYgKGRvYyAmJiBkb2MuY3JlYXRlRWxlbWVudE5TKSB7XG4gIC8vIE9ubHkgb3B0IGludG8gbmFtZXNwYWNlIGRldGVjdGlvbiBpZiBhIGNvbnRleHR1YWxFbGVtZW50XG4gIC8vIGlzIHBhc3NlZC5cbiAgcHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbih0YWdOYW1lLCBjb250ZXh0dWFsRWxlbWVudCkge1xuICAgIHZhciBuYW1lc3BhY2UgPSB0aGlzLm5hbWVzcGFjZTtcbiAgICBpZiAoY29udGV4dHVhbEVsZW1lbnQpIHtcbiAgICAgIGlmICh0YWdOYW1lID09PSAnc3ZnJykge1xuICAgICAgICBuYW1lc3BhY2UgPSBzdmdOYW1lc3BhY2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuYW1lc3BhY2UgPSBpbnRlcmlvck5hbWVzcGFjZShjb250ZXh0dWFsRWxlbWVudCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChuYW1lc3BhY2UpIHtcbiAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2UsIHRhZ05hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpO1xuICAgIH1cbiAgfTtcbiAgcHJvdG90eXBlLnNldEF0dHJpYnV0ZU5TID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZXNwYWNlLCBuYW1lLCB2YWx1ZSkge1xuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobmFtZXNwYWNlLCBuYW1lLCBTdHJpbmcodmFsdWUpKTtcbiAgfTtcbn0gZWxzZSB7XG4gIHByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24odGFnTmFtZSkge1xuICAgIHJldHVybiB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG4gIH07XG4gIHByb3RvdHlwZS5zZXRBdHRyaWJ1dGVOUyA9IGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWVzcGFjZSwgbmFtZSwgdmFsdWUpIHtcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShuYW1lLCBTdHJpbmcodmFsdWUpKTtcbiAgfTtcbn1cblxucHJvdG90eXBlLmFkZENsYXNzZXMgPSBhZGRDbGFzc2VzO1xucHJvdG90eXBlLnJlbW92ZUNsYXNzZXMgPSByZW1vdmVDbGFzc2VzO1xuXG5wcm90b3R5cGUuc2V0TmFtZXNwYWNlID0gZnVuY3Rpb24obnMpIHtcbiAgdGhpcy5uYW1lc3BhY2UgPSBucztcbn07XG5cbnByb3RvdHlwZS5kZXRlY3ROYW1lc3BhY2UgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gIHRoaXMubmFtZXNwYWNlID0gaW50ZXJpb3JOYW1lc3BhY2UoZWxlbWVudCk7XG59O1xuXG5wcm90b3R5cGUuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLmRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbn07XG5cbnByb3RvdHlwZS5jcmVhdGVUZXh0Tm9kZSA9IGZ1bmN0aW9uKHRleHQpe1xuICByZXR1cm4gdGhpcy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTtcbn07XG5cbnByb3RvdHlwZS5jcmVhdGVDb21tZW50ID0gZnVuY3Rpb24odGV4dCl7XG4gIHJldHVybiB0aGlzLmRvY3VtZW50LmNyZWF0ZUNvbW1lbnQodGV4dCk7XG59O1xuXG5wcm90b3R5cGUucmVwYWlyQ2xvbmVkTm9kZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGJsYW5rQ2hpbGRUZXh0Tm9kZXMsIGlzQ2hlY2tlZCl7XG4gIGlmIChkZWxldGVzQmxhbmtUZXh0Tm9kZXMgJiYgYmxhbmtDaGlsZFRleHROb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgZm9yICh2YXIgaT0wLCBsZW49YmxhbmtDaGlsZFRleHROb2Rlcy5sZW5ndGg7aTxsZW47aSsrKXtcbiAgICAgIHZhciB0ZXh0Tm9kZSA9IHRoaXMuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpLFxuICAgICAgICAgIG9mZnNldCA9IGJsYW5rQ2hpbGRUZXh0Tm9kZXNbaV0sXG4gICAgICAgICAgYmVmb3JlID0gdGhpcy5jaGlsZEF0SW5kZXgoZWxlbWVudCwgb2Zmc2V0KTtcbiAgICAgIGlmIChiZWZvcmUpIHtcbiAgICAgICAgZWxlbWVudC5pbnNlcnRCZWZvcmUodGV4dE5vZGUsIGJlZm9yZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKHRleHROb2RlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKGlnbm9yZXNDaGVja2VkQXR0cmlidXRlICYmIGlzQ2hlY2tlZCkge1xuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdjaGVja2VkJywgJ2NoZWNrZWQnKTtcbiAgfVxufTtcblxucHJvdG90eXBlLmNsb25lTm9kZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGRlZXApe1xuICB2YXIgY2xvbmUgPSBlbGVtZW50LmNsb25lTm9kZSghIWRlZXApO1xuICByZXR1cm4gY2xvbmU7XG59O1xuXG5wcm90b3R5cGUuQXR0ck1vcnBoQ2xhc3MgPSBBdHRyTW9ycGg7XG5cbnByb3RvdHlwZS5jcmVhdGVBdHRyTW9ycGggPSBmdW5jdGlvbihlbGVtZW50LCBhdHRyTmFtZSwgbmFtZXNwYWNlKXtcbiAgcmV0dXJuIHRoaXMuQXR0ck1vcnBoQ2xhc3MuY3JlYXRlKGVsZW1lbnQsIGF0dHJOYW1lLCB0aGlzLCBuYW1lc3BhY2UpO1xufTtcblxucHJvdG90eXBlLkVsZW1lbnRNb3JwaENsYXNzID0gRWxlbWVudE1vcnBoO1xuXG5wcm90b3R5cGUuY3JlYXRlRWxlbWVudE1vcnBoID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZXNwYWNlKXtcbiAgcmV0dXJuIG5ldyB0aGlzLkVsZW1lbnRNb3JwaENsYXNzKGVsZW1lbnQsIHRoaXMsIG5hbWVzcGFjZSk7XG59O1xuXG5wcm90b3R5cGUuY3JlYXRlVW5zYWZlQXR0ck1vcnBoID0gZnVuY3Rpb24oZWxlbWVudCwgYXR0ck5hbWUsIG5hbWVzcGFjZSl7XG4gIHZhciBtb3JwaCA9IHRoaXMuY3JlYXRlQXR0ck1vcnBoKGVsZW1lbnQsIGF0dHJOYW1lLCBuYW1lc3BhY2UpO1xuICBtb3JwaC5lc2NhcGVkID0gZmFsc2U7XG4gIHJldHVybiBtb3JwaDtcbn07XG5cbnByb3RvdHlwZS5Nb3JwaENsYXNzID0gTW9ycGg7XG5cbnByb3RvdHlwZS5jcmVhdGVNb3JwaCA9IGZ1bmN0aW9uKHBhcmVudCwgc3RhcnQsIGVuZCwgY29udGV4dHVhbEVsZW1lbnQpe1xuICBpZiAoY29udGV4dHVhbEVsZW1lbnQgJiYgY29udGV4dHVhbEVsZW1lbnQubm9kZVR5cGUgPT09IDExKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHBhc3MgYSBmcmFnbWVudCBhcyB0aGUgY29udGV4dHVhbCBlbGVtZW50IHRvIGNyZWF0ZU1vcnBoXCIpO1xuICB9XG5cbiAgaWYgKCFjb250ZXh0dWFsRWxlbWVudCAmJiBwYXJlbnQgJiYgcGFyZW50Lm5vZGVUeXBlID09PSAxKSB7XG4gICAgY29udGV4dHVhbEVsZW1lbnQgPSBwYXJlbnQ7XG4gIH1cbiAgdmFyIG1vcnBoID0gbmV3IHRoaXMuTW9ycGhDbGFzcyh0aGlzLCBjb250ZXh0dWFsRWxlbWVudCk7XG4gIG1vcnBoLmZpcnN0Tm9kZSA9IHN0YXJ0O1xuICBtb3JwaC5sYXN0Tm9kZSA9IGVuZDtcbiAgcmV0dXJuIG1vcnBoO1xufTtcblxucHJvdG90eXBlLmNyZWF0ZUZyYWdtZW50TW9ycGggPSBmdW5jdGlvbihjb250ZXh0dWFsRWxlbWVudCkge1xuICBpZiAoY29udGV4dHVhbEVsZW1lbnQgJiYgY29udGV4dHVhbEVsZW1lbnQubm9kZVR5cGUgPT09IDExKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHBhc3MgYSBmcmFnbWVudCBhcyB0aGUgY29udGV4dHVhbCBlbGVtZW50IHRvIGNyZWF0ZU1vcnBoXCIpO1xuICB9XG5cbiAgdmFyIGZyYWdtZW50ID0gdGhpcy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gIHJldHVybiBNb3JwaC5jcmVhdGUodGhpcywgY29udGV4dHVhbEVsZW1lbnQsIGZyYWdtZW50KTtcbn07XG5cbnByb3RvdHlwZS5yZXBsYWNlQ29udGVudFdpdGhNb3JwaCA9IGZ1bmN0aW9uKGVsZW1lbnQpICB7XG4gIHZhciBmaXJzdENoaWxkID0gZWxlbWVudC5maXJzdENoaWxkO1xuXG4gIGlmICghZmlyc3RDaGlsZCkge1xuICAgIHZhciBjb21tZW50ID0gdGhpcy5jcmVhdGVDb21tZW50KCcnKTtcbiAgICB0aGlzLmFwcGVuZENoaWxkKGVsZW1lbnQsIGNvbW1lbnQpO1xuICAgIHJldHVybiBNb3JwaC5jcmVhdGUodGhpcywgZWxlbWVudCwgY29tbWVudCk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIG1vcnBoID0gTW9ycGguYXR0YWNoKHRoaXMsIGVsZW1lbnQsIGZpcnN0Q2hpbGQsIGVsZW1lbnQubGFzdENoaWxkKTtcbiAgICBtb3JwaC5jbGVhcigpO1xuICAgIHJldHVybiBtb3JwaDtcbiAgfVxufTtcblxucHJvdG90eXBlLmNyZWF0ZVVuc2FmZU1vcnBoID0gZnVuY3Rpb24ocGFyZW50LCBzdGFydCwgZW5kLCBjb250ZXh0dWFsRWxlbWVudCl7XG4gIHZhciBtb3JwaCA9IHRoaXMuY3JlYXRlTW9ycGgocGFyZW50LCBzdGFydCwgZW5kLCBjb250ZXh0dWFsRWxlbWVudCk7XG4gIG1vcnBoLnBhcnNlVGV4dEFzSFRNTCA9IHRydWU7XG4gIHJldHVybiBtb3JwaDtcbn07XG5cbi8vIFRoaXMgaGVscGVyIGlzIGp1c3QgdG8ga2VlcCB0aGUgdGVtcGxhdGVzIGdvb2QgbG9va2luZyxcbi8vIHBhc3NpbmcgaW50ZWdlcnMgaW5zdGVhZCBvZiBlbGVtZW50IHJlZmVyZW5jZXMuXG5wcm90b3R5cGUuY3JlYXRlTW9ycGhBdCA9IGZ1bmN0aW9uKHBhcmVudCwgc3RhcnRJbmRleCwgZW5kSW5kZXgsIGNvbnRleHR1YWxFbGVtZW50KXtcbiAgdmFyIHNpbmdsZSA9IHN0YXJ0SW5kZXggPT09IGVuZEluZGV4O1xuICB2YXIgc3RhcnQgPSB0aGlzLmNoaWxkQXRJbmRleChwYXJlbnQsIHN0YXJ0SW5kZXgpO1xuICB2YXIgZW5kID0gc2luZ2xlID8gc3RhcnQgOiB0aGlzLmNoaWxkQXRJbmRleChwYXJlbnQsIGVuZEluZGV4KTtcbiAgcmV0dXJuIHRoaXMuY3JlYXRlTW9ycGgocGFyZW50LCBzdGFydCwgZW5kLCBjb250ZXh0dWFsRWxlbWVudCk7XG59O1xuXG5wcm90b3R5cGUuY3JlYXRlVW5zYWZlTW9ycGhBdCA9IGZ1bmN0aW9uKHBhcmVudCwgc3RhcnRJbmRleCwgZW5kSW5kZXgsIGNvbnRleHR1YWxFbGVtZW50KSB7XG4gIHZhciBtb3JwaCA9IHRoaXMuY3JlYXRlTW9ycGhBdChwYXJlbnQsIHN0YXJ0SW5kZXgsIGVuZEluZGV4LCBjb250ZXh0dWFsRWxlbWVudCk7XG4gIG1vcnBoLnBhcnNlVGV4dEFzSFRNTCA9IHRydWU7XG4gIHJldHVybiBtb3JwaDtcbn07XG5cbnByb3RvdHlwZS5pbnNlcnRNb3JwaEJlZm9yZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHJlZmVyZW5jZUNoaWxkLCBjb250ZXh0dWFsRWxlbWVudCkge1xuICB2YXIgaW5zZXJ0aW9uID0gdGhpcy5kb2N1bWVudC5jcmVhdGVDb21tZW50KCcnKTtcbiAgZWxlbWVudC5pbnNlcnRCZWZvcmUoaW5zZXJ0aW9uLCByZWZlcmVuY2VDaGlsZCk7XG4gIHJldHVybiB0aGlzLmNyZWF0ZU1vcnBoKGVsZW1lbnQsIGluc2VydGlvbiwgaW5zZXJ0aW9uLCBjb250ZXh0dWFsRWxlbWVudCk7XG59O1xuXG5wcm90b3R5cGUuYXBwZW5kTW9ycGggPSBmdW5jdGlvbihlbGVtZW50LCBjb250ZXh0dWFsRWxlbWVudCkge1xuICB2YXIgaW5zZXJ0aW9uID0gdGhpcy5kb2N1bWVudC5jcmVhdGVDb21tZW50KCcnKTtcbiAgZWxlbWVudC5hcHBlbmRDaGlsZChpbnNlcnRpb24pO1xuICByZXR1cm4gdGhpcy5jcmVhdGVNb3JwaChlbGVtZW50LCBpbnNlcnRpb24sIGluc2VydGlvbiwgY29udGV4dHVhbEVsZW1lbnQpO1xufTtcblxucHJvdG90eXBlLmluc2VydEJvdW5kYXJ5ID0gZnVuY3Rpb24oZnJhZ21lbnQsIGluZGV4KSB7XG4gIC8vIHRoaXMgd2lsbCBhbHdheXMgYmUgbnVsbCBvciBmaXJzdENoaWxkXG4gIHZhciBjaGlsZCA9IGluZGV4ID09PSBudWxsID8gbnVsbCA6IHRoaXMuY2hpbGRBdEluZGV4KGZyYWdtZW50LCBpbmRleCk7XG4gIHRoaXMuaW5zZXJ0QmVmb3JlKGZyYWdtZW50LCB0aGlzLmNyZWF0ZVRleHROb2RlKCcnKSwgY2hpbGQpO1xufTtcblxucHJvdG90eXBlLnNldE1vcnBoSFRNTCA9IGZ1bmN0aW9uKG1vcnBoLCBodG1sKSB7XG4gIG1vcnBoLnNldEhUTUwoaHRtbCk7XG59O1xuXG5wcm90b3R5cGUucGFyc2VIVE1MID0gZnVuY3Rpb24oaHRtbCwgY29udGV4dHVhbEVsZW1lbnQpIHtcbiAgdmFyIGNoaWxkTm9kZXM7XG5cbiAgaWYgKGludGVyaW9yTmFtZXNwYWNlKGNvbnRleHR1YWxFbGVtZW50KSA9PT0gc3ZnTmFtZXNwYWNlKSB7XG4gICAgY2hpbGROb2RlcyA9IGJ1aWxkU1ZHRE9NKGh0bWwsIHRoaXMpO1xuICB9IGVsc2Uge1xuICAgIHZhciBub2RlcyA9IGJ1aWxkSFRNTERPTShodG1sLCBjb250ZXh0dWFsRWxlbWVudCwgdGhpcyk7XG4gICAgaWYgKGRldGVjdE9taXR0ZWRTdGFydFRhZyhodG1sLCBjb250ZXh0dWFsRWxlbWVudCkpIHtcbiAgICAgIHZhciBub2RlID0gbm9kZXNbMF07XG4gICAgICB3aGlsZSAobm9kZSAmJiBub2RlLm5vZGVUeXBlICE9PSAxKSB7XG4gICAgICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgfVxuICAgICAgY2hpbGROb2RlcyA9IG5vZGUuY2hpbGROb2RlcztcbiAgICB9IGVsc2Uge1xuICAgICAgY2hpbGROb2RlcyA9IG5vZGVzO1xuICAgIH1cbiAgfVxuXG4gIC8vIENvcHkgbm9kZSBsaXN0IHRvIGEgZnJhZ21lbnQuXG4gIHZhciBmcmFnbWVudCA9IHRoaXMuZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXG4gIGlmIChjaGlsZE5vZGVzICYmIGNoaWxkTm9kZXMubGVuZ3RoID4gMCkge1xuICAgIHZhciBjdXJyZW50Tm9kZSA9IGNoaWxkTm9kZXNbMF07XG5cbiAgICAvLyBXZSBwcmVwZW5kIGFuIDxvcHRpb24+IHRvIDxzZWxlY3Q+IGJveGVzIHRvIGFic29yYiBhbnkgYnJvd3NlciBidWdzXG4gICAgLy8gcmVsYXRlZCB0byBhdXRvLXNlbGVjdCBiZWhhdmlvci4gU2tpcCBwYXN0IGl0LlxuICAgIGlmIChjb250ZXh0dWFsRWxlbWVudC50YWdOYW1lID09PSAnU0VMRUNUJykge1xuICAgICAgY3VycmVudE5vZGUgPSBjdXJyZW50Tm9kZS5uZXh0U2libGluZztcbiAgICB9XG5cbiAgICB3aGlsZSAoY3VycmVudE5vZGUpIHtcbiAgICAgIHZhciB0ZW1wTm9kZSA9IGN1cnJlbnROb2RlO1xuICAgICAgY3VycmVudE5vZGUgPSBjdXJyZW50Tm9kZS5uZXh0U2libGluZztcblxuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQodGVtcE5vZGUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmcmFnbWVudDtcbn07XG5cbnZhciBub2RlVVJMO1xudmFyIHBhcnNpbmdOb2RlO1xuXG5mdW5jdGlvbiBpbnN0YWxsRW52aXJvbm1lbnRTcGVjaWZpY01ldGhvZHMoZG9tSGVscGVyKSB7XG4gIHZhciBwcm90b2NvbCA9IGJyb3dzZXJQcm90b2NvbEZvclVSTC5jYWxsKGRvbUhlbHBlciwgJ2Zvb2JhcjpiYXonKTtcblxuICAvLyBUZXN0IHRvIHNlZSBpZiBvdXIgRE9NIGltcGxlbWVudGF0aW9uIHBhcnNlc1xuICAvLyBhbmQgbm9ybWFsaXplcyBVUkxzLlxuICBpZiAocHJvdG9jb2wgPT09ICdmb29iYXI6Jykge1xuICAgIC8vIFN3YXAgaW4gdGhlIG1ldGhvZCB0aGF0IGRvZXNuJ3QgZG8gdGhpcyB0ZXN0IG5vdyB0aGF0XG4gICAgLy8gd2Uga25vdyBpdCB3b3Jrcy5cbiAgICBkb21IZWxwZXIucHJvdG9jb2xGb3JVUkwgPSBicm93c2VyUHJvdG9jb2xGb3JVUkw7XG4gIH0gZWxzZSBpZiAodHlwZW9mIFVSTCA9PT0gJ29iamVjdCcpIHtcbiAgICAvLyBVUkwgZ2xvYmFsbHkgcHJvdmlkZWQsIGxpa2VseSBmcm9tIEZhc3RCb290J3Mgc2FuZGJveFxuICAgIG5vZGVVUkwgPSBVUkw7XG4gICAgZG9tSGVscGVyLnByb3RvY29sRm9yVVJMID0gbm9kZVByb3RvY29sRm9yVVJMO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUucmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIC8vIE90aGVyd2lzZSwgd2UgbmVlZCB0byBmYWxsIGJhY2sgdG8gb3VyIG93biBVUkwgcGFyc2luZy5cbiAgICAvLyBHbG9iYWwgYHJlcXVpcmVgIGlzIHNoYWRvd2VkIGJ5IEVtYmVyJ3MgbG9hZGVyIHNvIHdlIGhhdmUgdG8gdXNlIHRoZSBmdWxseVxuICAgIC8vIHF1YWxpZmllZCBgbW9kdWxlLnJlcXVpcmVgLlxuICAgIG5vZGVVUkwgPSBtb2R1bGUucmVxdWlyZSgndXJsJyk7XG4gICAgZG9tSGVscGVyLnByb3RvY29sRm9yVVJMID0gbm9kZVByb3RvY29sRm9yVVJMO1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRPTSBIZWxwZXIgY291bGQgbm90IGZpbmQgdmFsaWQgVVJMIHBhcnNpbmcgbWVjaGFuaXNtXCIpO1xuICB9XG5cbiAgLy8gQSBTaW1wbGVET00tc3BlY2lmaWMgZXh0ZW5zaW9uIHRoYXQgYWxsb3dzIHVzIHRvIHBsYWNlIEhUTUwgZGlyZWN0bHlcbiAgLy8gaW50byB0aGUgRE9NIHRyZWUsIGZvciB3aGVuIHRoZSBvdXRwdXQgdGFyZ2V0IGlzIGFsd2F5cyBzZXJpYWxpemVkIEhUTUwuXG4gIGlmIChkb21IZWxwZXIuZG9jdW1lbnQuY3JlYXRlUmF3SFRNTFNlY3Rpb24pIHtcbiAgICBkb21IZWxwZXIuc2V0TW9ycGhIVE1MID0gbm9kZVNldE1vcnBoSFRNTDtcbiAgfVxufVxuXG5mdW5jdGlvbiBub2RlU2V0TW9ycGhIVE1MKG1vcnBoLCBodG1sKSB7XG4gIHZhciBzZWN0aW9uID0gdGhpcy5kb2N1bWVudC5jcmVhdGVSYXdIVE1MU2VjdGlvbihodG1sKTtcbiAgbW9ycGguc2V0Tm9kZShzZWN0aW9uKTtcbn1cblxuZnVuY3Rpb24gYnJvd3NlclByb3RvY29sRm9yVVJMKHVybCkge1xuICBpZiAoIXBhcnNpbmdOb2RlKSB7XG4gICAgcGFyc2luZ05vZGUgPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgfVxuXG4gIHBhcnNpbmdOb2RlLmhyZWYgPSB1cmw7XG4gIHJldHVybiBwYXJzaW5nTm9kZS5wcm90b2NvbDtcbn1cblxuZnVuY3Rpb24gbm9kZVByb3RvY29sRm9yVVJMKHVybCkge1xuICB2YXIgcHJvdG9jb2wgPSBudWxsO1xuICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICBwcm90b2NvbCA9IG5vZGVVUkwucGFyc2UodXJsKS5wcm90b2NvbDtcbiAgfVxuICByZXR1cm4gKHByb3RvY29sID09PSBudWxsKSA/ICc6JyA6IHByb3RvY29sO1xufVxuXG5leHBvcnQgZGVmYXVsdCBET01IZWxwZXI7XG4iXX0=